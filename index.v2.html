<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>300+ Image Player</title>

    <!-- ====================== CSS ====================== -->
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html,body { height:100%; font-family:system-ui,sans-serif; background:#111; color:#eee; }

        #app { height:100vh; display:flex; flex-direction:column; }

        /* Navbar */
        #navbar {
            height:100px; background:#1a1a1a; border-bottom:1px solid #333;
            padding:0 15px; display:flex; flex-direction:column; justify-content:center; gap:8px;
            flex-shrink:0;
        }
        #controls { display:flex; align-items:center; gap:10px; flex-wrap:wrap; font-size:0.9rem; }
        #controls button { background:#333; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; }
        #controls button:hover { background:#555; }
        .speed-control,.loop-control { display:flex; align-items:center; gap:6px; }
        #speed { width:80px; }
        #progress-bar { height:4px; background:#333; border-radius:2px; overflow:hidden; }
        #progress-fill { height:100%; width:0%; background:#4a9eff; transition:width .1s linear; }

        /* Main */
        #main-container { flex:1; display:flex; flex-direction:column; overflow:hidden; }

        /* Sidebar */
        #sidebar {
            width:100%; background:#1e1e1e; padding:12px; border-bottom:1px solid #333;
            order:-1; max-height:0; overflow:hidden; transition:max-height .3s ease;
            position:relative;
        }
        #sidebar.open { max-height:300px; }
        #sidebar-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
        #sidebar h3 { font-size:1rem; color:#aaa; }
        #sidebar-toggle { background:none; border:none; color:#aaa; font-size:1.4rem; cursor:pointer; }

        /* Virtual Scroll Container */
        #thumbnail-container {
            height: 260px; overflow-y: auto; padding: 0 4px;
        }
        #thumbnail-list {
            position: relative; width: 100%;
        }
        .thumbnail {
            width:70px; height:70px; object-fit:cover; border-radius:6px;
            cursor:pointer; opacity:.7; transition:all .2s; border:2px solid transparent;
            display: block; margin: 4px;
            background: #222;
        }
        .thumbnail:hover, .thumbnail.active { opacity:1; }
        .thumbnail.active { border-color:#4a9eff; transform:scale(1.1); }
        .thumbnail.loading::after {
            content: ""; position: absolute; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%234a9eff" d="M12,4V2A10,10 0 0,1 22,12H24A12,12 0 0,0 12,0V4Z"/></svg>') center/16px no-repeat;
        }

        /* Image Area */
        #image-area {
            flex:1; display:flex; justify-content:center; align-items:center;
            background:#000; padding:15px;
        }
        #current-slide {
            max-width:100%; max-height:100%; object-fit:contain;
            border-radius:8px; box-shadow:0 10px 30px rgba(0,0,0,.5);
        }

        #play-pause::after { content:"Play"; }
        #play-pause.playing::after { content:"Pause"; }

        @media (min-width:768px) {
            #main-container { flex-direction:row; }
            #sidebar { width:280px; min-width:280px; max-height:none; padding:20px; border-bottom:none; border-right:1px solid #333; order:0; }
            #sidebar.open { max-height:none; }
            #sidebar-toggle { display:none; }
            #thumbnail-container { height: auto; max-height: calc(100vh - 200px); }
            #thumbnail-list { display: flex; flex-wrap: wrap; gap: 8px; }
            .thumbnail { width: calc(50% - 8px); max-height: 100px; }
        }

        .status { position: fixed; bottom: 10px; right: 10px; background: #0008; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; }
    </style>
</head>
<body>
    <div id="app">

        <!-- Navbar -->
        <header id="navbar">
            <div id="controls">
                <button id="play-pause">Play</button>
                <button id="prev">Prev</button>
                <button id="next">Next</button>
                <label class="speed-control">
                    Speed:
                    <input type="range" id="speed" min="0.1" max="5" step="0.1" value="1">
                    <span id="speed-value">1x</span>
                </label>
                <label class="loop-control">
                    Loop
                    <input type="checkbox" id="loop" checked>
                </label>
            </div>
            <div id="progress-bar"><div id="progress-fill"></div></div>
        </header>

        <!-- Main -->
        <div id="main-container">
            <aside id="sidebar">
                <div id="sidebar-header">
                    <h3>Images (<span id="image-count">0</span>)</h3>
                    <button id="sidebar-toggle">Menu</button>
                </div>
                <div id="thumbnail-container">
                    <div id="thumbnail-list"></div>
                </div>
            </aside>

            <main id="image-area">
                <img id="current-slide" src="" alt="Current slide">
            </main>
        </div>
    </div>

    <div class="status" id="status">Loading images...</div>

    <!-- ====================== JS ====================== -->
    <script>
        // === CONFIG ===
        const IMAGES_URL = 'static/json/images.json';  // 300+ images here
        const THUMBNAIL_HEIGHT = 78;  // px per thumbnail (mobile)
        const DESKTOP_THUMBNAIL_HEIGHT = 116;

        // === STATE ===
        let images = [];
        let current = 0;
        let playing = false;
        let speed = 1;
        let timer = null;
        let renderedRange = { start: 0, end: 0 };

        // === DOM ===
        const els = {
            slide: document.getElementById('current-slide'),
            thumbs: document.getElementById('thumbnail-list'),
            container: document.getElementById('thumbnail-container'),
            progress: document.getElementById('progress-fill'),
            status: document.getElementById('status'),
            count: document.getElementById('image-count')
        };

        // === VIRTUAL SCROLL ===
        function renderThumbnails() {
            const isDesktop = window.innerWidth >= 768;
            const itemHeight = isDesktop ? DESKTOP_THUMBNAIL_HEIGHT : THUMBNAIL_HEIGHT;
            const visibleCount = Math.ceil(els.container.clientHeight / itemHeight) + 5;
            const scrollTop = els.container.scrollTop;
            const start = Math.max(0, Math.floor(scrollTop / itemHeight) - 2);
            const end = Math.min(images.length, start + visibleCount);

            if (start === renderedRange.start && end === renderedRange.end) return;
            renderedRange = { start, end };

            const frag = document.createDocumentFragment();
            els.thumbs.innerHTML = '';
            els.thumbs.style.height = (images.length * itemHeight) + 'px';

            for (let i = start; i < end; i++) {
                const img = images[i];
                const thumb = document.createElement('img');
                thumb.className = 'thumbnail';
                thumb.dataset.index = i;
                thumb.style.position = 'absolute';
                thumb.style.top = (i * itemHeight) + 'px';
                thumb.style.width = isDesktop ? 'calc(50% - 8px)' : '70px';
                thumb.style.height = (itemHeight - 8) + 'px';
                thumb.loading = 'lazy';
                thumb.src = img.src;
                thumb.onclick = () => goTo(i);
                if (i === current) thumb.classList.add('active');
                frag.appendChild(thumb);
            }
            els.thumbs.appendChild(frag);
        }

        // === PLAYER ===
        function show(idx) {
            current = (idx + images.length) % images.length;
            els.slide.src = images[current].src;
            updateProgress();
            highlightThumb();
        }

        function next() { show(current + 1); if (playing) restart(); }
        function prev() { show(current - 1); if (playing) restart(); }
        function goTo(i) { show(i); if (playing) restart(); }

        function toggle() { playing ? pause() : play(); }
        function play() {
            if (images.length < 2) return;
            playing = true;
            document.getElementById('play-pause').classList.add('playing');
            start();
        }
        function pause() {
            playing = false;
            document.getElementById('play-pause').classList.remove('playing');
            clearInterval(timer);
        }
        function start() {
            clearInterval(timer);
            const delay = 1000 / speed;
            timer = setInterval(() => {
                if (!document.getElementById('loop').checked && current === images.length - 1) {
                    pause(); return;
                }
                next();
            }, delay);
        }
        function restart() { if (playing) start(); }

        function updateProgress() {
            const pct = images.length > 1 ? (current / (images.length - 1)) * 100 : 0;
            els.progress.style.width = pct + '%';
        }

        function highlightThumb() {
            document.querySelectorAll('.thumbnail').forEach((t, i) => {
                t.classList.toggle('active', i === current);
            });
        }

        // === INIT ===
        async function loadImages() {
            try {
                const res = await fetch(IMAGES_URL);
                if (!res.ok) throw new Error(res.status);
                images = await res.json();
                els.count.textContent = images.length;
                els.status.textContent = `Loaded ${images.length} images`;
                show(0);
                renderThumbnails();
            } catch (e) {
                els.status.textContent = 'Failed to load images.json';
                console.error(e);
            }
        }

        // === EVENTS ===
        document.getElementById('play-pause').onclick = toggle;
        document.getElementById('prev').onclick = prev;
        document.getElementById('next').onclick = next;
        document.getElementById('speed').oninput = (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = speed.toFixed(1) + 'x';
            if (playing) start();
        };
        document.getElementById('sidebar-toggle').onclick = () => {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('open');
            document.getElementById('sidebar-toggle').textContent = sb.classList.contains('open') ? 'X' : 'Menu';
        };

        els.container.onscroll = renderThumbnails;
        window.onresize = renderThumbnails;

        // === START ===
        window.onload = () => {
            loadImages();
            if (window.innerWidth < 768 && images.length > 0) {
                document.getElementById('sidebar').classList.add('open');
                document.getElementById('sidebar-toggle').textContent = 'X';
            }
        };
    </script>
</body>
</html>